<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>3.7&nbsp;C Struct Types</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" data-pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewselflink" data-pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="foreign_pointer-funcs.html" class="tocviewlink" data-pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" data-pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" data-pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" data-pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>3&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">C Types</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="ctype.html" class="tocviewlink" data-pltdoc="x">Type Constructors</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="Numeric_Types.html" class="tocviewlink" data-pltdoc="x">Numeric Types</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="Other_Atomic_Types.html" class="tocviewlink" data-pltdoc="x">Other Atomic Types</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="String_Types.html" class="tocviewlink" data-pltdoc="x">String Types</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="Pointer_Types.html" class="tocviewlink" data-pltdoc="x">Pointer Types</a></td></tr><tr><td align="right">3.6&nbsp;</td><td><a href="foreign_procedures.html" class="tocviewlink" data-pltdoc="x">Function Types</a></td></tr><tr><td align="right">3.7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">C Struct Types</a></td></tr><tr><td align="right">3.8&nbsp;</td><td><a href="C_Array_Types.html" class="tocviewlink" data-pltdoc="x">C Array Types</a></td></tr><tr><td align="right">3.9&nbsp;</td><td><a href="C_Union_Types.html" class="tocviewlink" data-pltdoc="x">C Union Types</a></td></tr><tr><td align="right">3.10&nbsp;</td><td><a href="Enumerations_and_Masks.html" class="tocviewlink" data-pltdoc="x">Enumerations and Masks</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#(def._((quote._~23~25foreign)._make-cstruct-type))" class="tocsublink" data-pltdoc="x"><span title="Provided from: ffi/unsafe"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>cstruct-<wbr></wbr>type</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._ffi/unsafe..rkt).__list-struct))" class="tocsublink" data-pltdoc="x"><span title="Provided from: ffi/unsafe"><span class="RktSym"><span class="RktValLink">_<span class="mywbr"> </span>list-<wbr></wbr>struct</span></span></span></a></td></tr><tr><td><a href="#(form._((lib._ffi/unsafe..rkt)._define-cstruct))" class="tocsublink" data-pltdoc="x"><span title="Provided from: ffi/unsafe"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>cstruct</span></span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="foreign_procedures.html" title="backward to &quot;3.6 Function Types&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="types.html" title="up to &quot;3 C Types&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="C_Array_Types.html" title="forward to &quot;3.8 C Array Types&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>3.7<tt>&nbsp;</tt><a name="(part._.C_.Struct_.Types)"></a>C Struct Types</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((quote._~23~25foreign)._make-cstruct-type))"></a><span title="Provided from: ffi/unsafe"><span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-cstruct-type%29%29" class="RktValLink" data-pltdoc="x">make-cstruct-type</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">types</span><span class="hspace">&nbsp;</span>[<span class="RktVar">abi</span><span class="hspace">&nbsp;</span><span class="RktVar">alignment</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">types</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">abi</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">default</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">stdcall</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sysv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">alignment</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">The primitive type constructor for creating new C struct types.  These
types are actually new primitive types; they have no conversion
functions associated.  The corresponding Racket objects that are used
for structs are pointers, but when these types are used, the value
that the pointer <span style="font-style: italic">refers to</span> is used, rather than the pointer
itself.  This value is basically made of a number of bytes that is
known according to the given list of <span class="RktVar">types</span> list.</div></p><p>If <span class="RktVar">alignment</span> is <span class="RktVal">#f</span>, then the natural alignment of
each type in <span class="RktVar">types</span> is used for its alignment within the
struct type. Otherwise, <span class="RktVar">alignment</span> is used for all struct type
members.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._ffi/unsafe..rkt).__list-struct))"></a><span title="Provided from: ffi/unsafe"><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span></span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:alignment</span><span class="hspace">&nbsp;</span><span class="RktVar">alignment</span>]</td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">type</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">alignment</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">16</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="ctype.html#%28def._%28%28quote._~23~25foreign%29._ctype~3f%29%29" class="RktValLink" data-pltdoc="x">ctype?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A type constructor that builds a struct type using
<span class="RktSym"><a href="#%28def._%28%28quote._~23~25foreign%29._make-cstruct-type%29%29" class="RktValLink" data-pltdoc="x">make-cstruct-type</a></span> function and wraps it in a type that
marshals a struct as a list of its components.  Note that space for
structs must to be allocated; the converter for a
<span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span> type immediately allocates and uses a list from
the allocated space, so it is inefficient. Use <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span>
below for a more efficient approach.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._ffi/unsafe..rkt)._define-cstruct))"></a><span title="Provided from: ffi/unsafe"><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id/sup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">field-id</span><span class="hspace">&nbsp;</span><span class="RktVar">type-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">property</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">id/sup</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">_id</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">_id</span><span class="hspace">&nbsp;</span><span class="RktVar">super-id</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">property</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:alignment</span><span class="hspace">&nbsp;</span><span class="RktVar">alignment-expr</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:property</span><span class="hspace">&nbsp;</span><span class="RktVar">prop-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">val-expr</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Defines a new C struct type, but unlike <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span>, the
resulting type deals with C structs in binary form, rather than
marshaling them to Racket values.  The syntax is similar to
<span class="RktSym"><a href="../reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span>, providing accessor functions for raw struct
values (which are pointer objects); the <span class="RktVar">_id</span>
must start with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">_</span><span class="hspace"></span></span>, and at most one <span class="RktPn">#:alignment</span>
can be supplied.</div></p><p>The resulting bindings are as follows:</p><ul><li><p><span class="RktVar">_id</span> : the new C type for this struct.</p></li><li><p><span class="RktVar">_id</span><span class="RktSym">-pointer</span>: a pointer type that should
be used when a pointer to values of this struct are used.</p></li><li><p><span class="RktVar">_id</span><span class="RktSym">-pointer/null</span>: like
<span class="RktVar">_id</span><span class="RktSym">-pointer</span>, but allowing NULL pointers (as
represented on the Racket side by <span class="RktVal">#f</span>).</p></li><li><p><span class="RktVar">id</span><span class="RktSym">?</span>: a predicate for the new type.</p></li><li><p><span class="RktVar">id</span><span class="RktSym">-tag</span>: the tag object that is
used with instances.  The tag object may be the symbol form of
<span class="RktVar">id</span> or a list of symbols containing the <span class="RktVar">id</span>
symbol and other symbols, such as the <span class="RktVar">super-id</span> symbol.</p></li><li><p><span class="RktSym">make-</span><span class="RktVar">id</span> : a constructor, which expects
an argument for each field.</p></li><li><p><span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-id</span> : an accessor
function for each <span class="RktVar">field-id</span>; if the field has a C struct type, then
the result of the accessor is a pointer to the field within the
enclosing structure, rather than a  copy of the field.</p></li><li><p><span class="RktSym">set-</span><span class="RktVar">id</span><span class="RktSym">-</span><span class="RktVar">field-id</span><span class="RktSym">!</span>
: a mutator function for each <span class="RktVar">field-id</span>.</p></li><li><p><span class="RktVar">id</span>: structure-type information compatible with
<span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct-out%29%29" class="RktStxLink" data-pltdoc="x">struct-out</a></span> or <span class="RktSym"><a href="../reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span> (but not <span class="RktSym"><a href="../reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span> or
<span class="RktSym"><a href="../reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span>);
currently, this information is correct only when no <span class="RktVar">super-id</span>
is specified.</p></li><li><p><span class="RktVar">id</span><span class="RktSym">-&gt;list</span>,
<span class="RktSym">list-&gt;</span><span class="RktVar">id</span> : a function that converts a
struct into a list of field values and vice versa.</p></li><li><p><span class="RktVar">id</span><span class="RktSym">-&gt;list*</span>,
<span class="RktSym">list*-&gt;</span><span class="RktVar">id</span> : like
<span class="RktVar">id</span><span class="RktSym">-&gt;list</span>,
<span class="RktSym">list-&gt;</span><span class="RktVar">id</span>, but fields that are structs
are recursively unpacked to lists or packed from lists.</p></li><li><p><span class="RktSym">struct:</span><span class="RktVar">id</span><span class="RktSym">:cpointer</span>:
only when a <span class="RktPn">#:property</span> is specified &#8212;<wbr></wbr> a structure type that
corresponds to a wrapper to reflect properties (see below).</p></li></ul><p>Objects of the new type are actually C pointers, with a type tag that
is the symbol form of <span class="RktVar">id</span> or a list that contains the
symbol form of <span class="RktVar">id</span>.  Since
structs are implemented as pointers, they can be used for a
<span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__pointer%29%29" class="RktValLink" data-pltdoc="x">_pointer</a></span> input to a foreign function: their address will be
used.  To make this a little safer, the corresponding cpointer type is
defined as <span class="RktVar">_id</span><span class="RktSym">-pointer</span>.  The <span class="RktVar">_id</span> type
should not be used when a pointer is expected, since it will cause the
struct to be copied rather than use the pointer value, leading to
memory corruption.</p><p>Instances of the new type are not normally Racket structure instances.
However, if at least one <span class="RktPn">#:property</span> modifier is specified,
then struct creation and coercions from <span class="RktVar">_id</span> variants wrap a
non-NULL C pointer representation in a Racket structure that has the
specified properties. The wrapper Racket structure also has a
<span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._prop~3acpointer%29%29" class="RktValLink" data-pltdoc="x">prop:cpointer</a></span> property, so that wrapped C pointers can be
treated the same as unwrapped C pointers. If a <span class="RktVar">super-id</span> is
provided and it corresponds to a C struct type with a wrapper
structure type, then the wrapper structure type is a subtype of
<span class="RktVar">super-id</span>&rsquo;s wrapper structure type.</p><p>If the first field is itself a C struct type, its tag will be used in
addition to the new tag.  This feature supports common cases of object
inheritance, where a sub-struct is made by having a first field that
is its super-struct.  Instances of the sub-struct can be considered as
instances of the super-struct, since they share the same initial
layout.  Using the tag of an initial C struct field means that the same
behavior is implemented in Racket; for example, accessors and mutators
of the super-struct can be used with the new sub-struct.  See the
example below.</p><p>Providing a <span class="RktVar">super-id</span> is shorthand for using an initial field
named <span class="RktVar">super-id</span> and using <span class="RktSym">_</span><span class="RktVar">super-id</span>
as its type.  Thus, the new struct will use
<span class="RktSym">_</span><span class="RktVar">super-id</span>&rsquo;s tag in addition to its own tag,
meaning that instances of <span class="RktVar">_id</span> can be used as instances of
<span class="RktSym">_</span><span class="RktVar">super-id</span>.  Aside from the syntactic sugar,
the constructor function is different when this syntax is used:
instead of expecting a first argument that is an instance of
<span class="RktSym">_</span><span class="RktVar">super-id</span>, the constructor will expect
arguments for each of <span class="RktSym">_</span><span class="RktVar">super-id</span>&rsquo;s fields, in
addition for the new fields.  This adjustment of the constructor is,
again, in analogy to using a supertype with <span class="RktSym"><a href="../reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span>.</p><p>Structs are allocated as atomic blocks, which means that the
garbage collector ignores their content.  Thus, struct fields can hold
only non-pointer values, pointers to memory outside the GC&rsquo;s control,
and otherwise-reachable pointers to immobile GC-managed values (such
as those allocated with <span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._malloc%29%29" class="RktValLink" data-pltdoc="x">malloc</a></span> and <span class="RktVal">'</span><span class="RktVal">internal</span> or
<span class="RktVal">'</span><span class="RktVal">internal-atomic</span>).</p><p>As an example, consider the following C code:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">typedef struct { int x; char y; } A;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">typedef struct { A a; int z; } B;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">A* makeA() {</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">A *p = malloc(sizeof(A));</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">p-&gt;x = 1;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">p-&gt;y = 2;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return p;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">B* makeB() {</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">B *p = malloc(sizeof(B));</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">p-&gt;a.x = 1;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">p-&gt;a.y = 2;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span>p-&gt;z<span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">= 3;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return p;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">char gety(A* a) {</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">return a-&gt;y;</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">}</span></span></p></td></tr></table></p><p>Using the simple <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span>, you might expect this code to
work:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">makeB</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Loading_Foreign_Libraries.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29._get-ffi-obj%29%29" class="RktValLink" data-pltdoc="x">get-ffi-obj</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">makeB</span><span class="hspace">&nbsp;</span><span class="RktVal">"foo.so"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">makeB</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">should return </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktVal">)</span></td></tr></table></blockquote><p>The problem here is that <span class="stt">makeB</span> returns a pointer to the struct rather
than the struct itself.  The following works as expected:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">makeB</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Loading_Foreign_Libraries.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29._get-ffi-obj%29%29" class="RktValLink" data-pltdoc="x">get-ffi-obj</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">makeB</span><span class="hspace">&nbsp;</span><span class="RktVal">"foo.so"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Pointer_Types.html#%28def._%28%28quote._~23~25foreign%29.__pointer%29%29" class="RktValLink" data-pltdoc="x">_pointer</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._ptr-ref%29%29" class="RktValLink" data-pltdoc="x">ptr-ref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">makeB</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>As described above, <span class="RktSym"><a href="#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__list-struct%29%29" class="RktValLink" data-pltdoc="x">_list-struct</a></span>s should be used in cases where
efficiency is not an issue.  We continue using <span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span>, first
define a type for <span class="stt">A</span> which makes it possible to use <span class="stt">makeA</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">makeA</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Loading_Foreign_Libraries.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29._get-ffi-obj%29%29" class="RktValLink" data-pltdoc="x">get-ffi-obj</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">makeA</span><span class="hspace">&nbsp;</span><span class="RktVal">"foo.so"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym">_A-pointer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">using </span><span class="RktSym">_A</span><span class="RktCmt"> is a memory-corrupting bug!</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">makeA</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-x</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-y</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">produces an </span><span class="RktSym">A</span><span class="RktCmt"> containing </span><span class="RktVal">1</span><span class="RktCmt"> and </span><span class="RktVal">2</span></td></tr></table></blockquote><p>Using <span class="stt">gety</span> is also simple:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">gety</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Loading_Foreign_Libraries.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29._get-ffi-obj%29%29" class="RktValLink" data-pltdoc="x">get-ffi-obj</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">gety</span><span class="hspace">&nbsp;</span><span class="RktVal">"foo.so"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_A-pointer</span><span class="hspace">&nbsp;</span><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__byte%29%29" class="RktValLink" data-pltdoc="x">_byte</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">gety</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">produces </span><span class="RktVal">2</span></td></tr></table></blockquote><p>We now define another C struct for <span class="stt">B</span>, and expose <span class="stt">makeB</span>
using it:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">_B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">_A</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">makeB</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Loading_Foreign_Libraries.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29._get-ffi-obj%29%29" class="RktValLink" data-pltdoc="x">get-ffi-obj</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">makeB</span><span class="hspace">&nbsp;</span><span class="RktVal">"foo.so"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29.__fun%29%29" class="RktStxLink" data-pltdoc="x">_fun</a></span><span class="hspace">&nbsp;</span><a href="foreign_procedures.html#%28form._%28%28lib._ffi%2Funsafe..rkt%29._-~3e%29%29" class="plainlink" data-pltdoc="x"><span class="RktKw">-&gt;</span></a><span class="hspace">&nbsp;</span><span class="RktSym">_B-pointer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">makeB</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>We can access all values of <span class="RktSym">b</span> using a naive approach:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">B-a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-y</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">B-a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">B-z</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>but this is inefficient as it allocates and copies an instance of
<span class="stt">A</span> on every access.  Inspecting the tags <span class="RktPn">(</span><span class="RktSym"><a href="foreign_pointer-funcs.html#%28def._%28%28quote._~23~25foreign%29._cpointer-tag%29%29" class="RktValLink" data-pltdoc="x">cpointer-tag</a></span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span> we can see that <span class="stt">A</span>&rsquo;s tag is included, so we can simply use
its accessors and mutators, as well as any function that is defined to
take an <span class="stt">A</span> pointer:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-x</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A-y</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">B-z</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">gety</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Constructing a <span class="stt">B</span> instance in Racket requires allocating a
 temporary <span class="stt">A</span> struct:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-B</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-A</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>To make this more efficient, we switch to the alternative
<span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span> syntax, which creates a constructor that
expects arguments for both the super fields and the new ones:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._ffi%2Funsafe..rkt%29._define-cstruct%29%29" class="RktStxLink" data-pltdoc="x">define-cstruct</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_B</span><span class="hspace">&nbsp;</span><span class="RktSym">_A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Numeric_Types.html#%28def._%28%28lib._ffi%2Funsafe..rkt%29.__int%29%29" class="RktValLink" data-pltdoc="x">_int</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-B</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="foreign_procedures.html" title="backward to &quot;3.6 Function Types&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="types.html" title="up to &quot;3 C Types&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="C_Array_Types.html" title="forward to &quot;3.8 C Array Types&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>