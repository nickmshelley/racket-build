<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>1&nbsp;raco make: Compiling Source to Bytecode</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco</span>:<span class="mywbr"> </span> Racket Command-<wbr></wbr>Line Tools</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x"><span class="stt">raco make</span>:<span class="mywbr"> </span> Compiling Source to Bytecode</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="link.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco link</span>:<span class="mywbr"> </span> Library Collection Links</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="exe.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco exe</span>:<span class="mywbr"> </span> Creating Stand-<wbr></wbr>Alone Executables</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="exe-dist.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco distribute</span>:<span class="mywbr"> </span> Sharing Stand-<wbr></wbr>Alone Executables</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="plt.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco pack</span>:<span class="mywbr"> </span> Packing Library Collections</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="unpack.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco unpack</span>:<span class="mywbr"> </span> Unpacking Library Collections</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="planet.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco planet</span>:<span class="mywbr"> </span> Automatic Package Distribution</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="pkg.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco pkg</span>:<span class="mywbr"> </span> Package Management</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="setup.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco setup</span>:<span class="mywbr"> </span> Installation Management</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="decompile.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco decompile</span>:<span class="mywbr"> </span> Decompiling Bytecode</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="demod.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco demod</span>:<span class="mywbr"> </span> Demodularizing Programs</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="ctool.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco ctool</span>:<span class="mywbr"> </span> Working with C Code</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="test.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco test</span>:<span class="mywbr"> </span> Run tests</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="docs.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco docs</span>:<span class="mywbr"> </span> Documentation Search</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="expand.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco expand</span>:<span class="mywbr"> </span> Macro Expansion</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="scribble.html" class="tocviewlink" data-pltdoc="x"><span class="stt">raco scribble</span>:<span class="mywbr"> </span> Building Documentation</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="command.html" class="tocviewlink" data-pltdoc="x">Adding a <span class="stt">raco</span> Command</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>1&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x"><span class="stt">raco make</span>:<span class="mywbr"> </span> Compiling Source to Bytecode</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1.1&nbsp;</td><td><a href="#%28part._.Bytecode_.Files%29" class="tocviewlink" data-pltdoc="x">Bytecode Files</a></td></tr><tr><td align="right">1.2&nbsp;</td><td><a href="#%28part._.Dependency_.Files%29" class="tocviewlink" data-pltdoc="x">Dependency Files</a></td></tr><tr><td align="right">1.3&nbsp;</td><td><a href="#%28part._.A.P.I_for_.Making_.Bytecode%29" class="tocviewlink" data-pltdoc="x">API for Making Bytecode</a></td></tr><tr><td align="right">1.4&nbsp;</td><td><a href="#%28part._api~3aparallel-build%29" class="tocviewlink" data-pltdoc="x">API for Parallel Builds</a></td></tr><tr><td align="right">1.5&nbsp;</td><td><a href="#%28part._.Compilation_.Manager_.Hook_for_.Syntax_.Transformers%29" class="tocviewlink" data-pltdoc="x">Compilation Manager Hook for Syntax Transformers</a></td></tr><tr><td align="right">1.6&nbsp;</td><td><a href="#%28part._zo%29" class="tocviewlink" data-pltdoc="x">Compiling to Raw Bytecode</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#(part._.Bytecode_.Files)" class="tocsubseclink" data-pltdoc="x">Bytecode Files</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#(part._.Dependency_.Files)" class="tocsubseclink" data-pltdoc="x">Dependency Files</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#(part._.A.P.I_for_.Making_.Bytecode)" class="tocsubseclink" data-pltdoc="x">API for Making Bytecode</a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._make-compilation-manager-load/use-compiled-handler))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>compilation-<wbr></wbr>manager-<wbr></wbr>load/<span class="mywbr"> </span>use-<wbr></wbr>compiled-<wbr></wbr>handler</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._managed-compile-zo))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">managed-<wbr></wbr>compile-<wbr></wbr>zo</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._trust-existing-zos))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">trust-<wbr></wbr>existing-<wbr></wbr>zos</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._make-caching-managed-compile-zo))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>caching-<wbr></wbr>managed-<wbr></wbr>compile-<wbr></wbr>zo</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._manager-compile-notify-handler))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">manager-<wbr></wbr>compile-<wbr></wbr>notify-<wbr></wbr>handler</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._manager-trace-handler))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">manager-<wbr></wbr>trace-<wbr></wbr>handler</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._manager-skip-file-handler))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">manager-<wbr></wbr>skip-<wbr></wbr>file-<wbr></wbr>handler</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._file-stamp-in-collection))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">file-<wbr></wbr>stamp-<wbr></wbr>in-<wbr></wbr>collection</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._file-stamp-in-paths))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">file-<wbr></wbr>stamp-<wbr></wbr>in-<wbr></wbr>paths</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._get-file-sha1))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">get-<wbr></wbr>file-<wbr></wbr>sha1</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._get-compiled-file-sha1))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">get-<wbr></wbr>compiled-<wbr></wbr>file-<wbr></wbr>sha1</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._with-compile-output))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">with-<wbr></wbr>compile-<wbr></wbr>output</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._parallel-lock-client))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">parallel-<wbr></wbr>lock-<wbr></wbr>client</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._compile-lock-~3eparallel-lock-client))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">compile-<wbr></wbr>lock-<wbr></wbr>&gt;parallel-<wbr></wbr>lock-<wbr></wbr>client</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm..rkt)._make-compile-lock))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm"><span class="RktSym"><span class="RktValLink">make-<wbr></wbr>compile-<wbr></wbr>lock</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#(part._api~3aparallel-build)" class="tocsubseclink" data-pltdoc="x">API for Parallel Builds</a></td></tr><tr><td><a href="#(def._((lib._setup/parallel-build..rkt)._parallel-compile-files))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: setup/parallel-build"><span class="RktSym"><span class="RktValLink">parallel-<wbr></wbr>compile-<wbr></wbr>files</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._setup/parallel-build..rkt)._parallel-compile))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: setup/parallel-build"><span class="RktSym"><span class="RktValLink">parallel-<wbr></wbr>compile</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#(part._.Compilation_.Manager_.Hook_for_.Syntax_.Transformers)" class="tocsubseclink" data-pltdoc="x">Compilation Manager Hook for Syntax Transformers</a></td></tr><tr><td><a href="#(def._((lib._compiler/cm-accomplice..rkt)._register-external-file))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm-accomplice"><span class="RktSym"><span class="RktValLink">register-<wbr></wbr>external-<wbr></wbr>file</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._compiler/cm-accomplice..rkt)._register-external-module))" class="tocsubnonseclink" data-pltdoc="x"><span title="Provided from: compiler/cm-accomplice"><span class="RktSym"><span class="RktValLink">register-<wbr></wbr>external-<wbr></wbr>module</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.6<tt>&nbsp;</tt></span><a href="#(part._zo)" class="tocsubseclink" data-pltdoc="x">Compiling to Raw Bytecode</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;raco: Racket Command-Line Tools&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;raco: Racket Command-Line Tools&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="link.html" title="forward to &quot;2 raco link: Library Collection Links&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>1<tt>&nbsp;</tt><a name="(part._make)"></a><span class="stt">raco make</span>: Compiling Source to Bytecode</h3><p>The <span class="stt">raco make</span> command accept filenames for Racket modules to be
compiled to bytecode format. Modules are re-compiled only if the
source Racket file is newer than the bytecode file and has a different
SHA-1 hash, or if any imported module is recompiled or has a different
SHA-1 hash for its compiled form plus dependencies.</p><p>The <span class="stt">raco make</span> command accepts a few flags:</p><ul><li><p><span class="nobreak"><span class="stt">-j</span></span> &#8249;<span style="font-style: italic">n</span>&#8250; &#8212;<wbr></wbr> Compiles argument modules in parallel,
using up to &#8249;<span style="font-style: italic">n</span>&#8250; parallel tasks.</p></li><li><p><span class="nobreak"><span class="stt">--disable-inline</span></span> &#8212;<wbr></wbr> Disables function inlining while
compiling (but does not re-compile files that are already
up-to-date). This flag is often useful to simplify generated
code before decompiling, and it corresponds to setting
<span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._compile-context-preservation-enabled%29%29" class="RktValLink" data-pltdoc="x">compile-context-preservation-enabled</a></span> to <span class="RktVal">#t</span>.</p></li><li><p><span class="nobreak"><span class="stt">--disable-constant</span></span> &#8212;<wbr></wbr> Disables inference of definitions
within a module as constant (but does not re-compile files that
are already up-to-date). The value associated with a
non-constant definition is never inlined or constant-propagated,
either within its own module or an importing module. This flag
corresponds to setting <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._compile-enforce-module-constants%29%29" class="RktValLink" data-pltdoc="x">compile-enforce-module-constants</a></span>
to <span class="RktVal">#f</span>.</p></li><li><p><span class="nobreak"><span class="stt">--no-deps</span></span> &#8212;<wbr></wbr> Compiles a non-module file (i.e., one that
is run via <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._load%29%29" class="RktValLink" data-pltdoc="x">load</a></span> instead of <span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span>). See
<a href="#%28part._zo%29" data-pltdoc="x">Compiling to Raw Bytecode</a> for more information.</p></li><li><p><span class="nobreak"><span class="stt">-p</span></span> &#8249;<span style="font-style: italic">file</span>&#8250; or <span class="nobreak"><span class="stt">--prefix</span></span> &#8249;<span style="font-style: italic">file</span>&#8250; &#8212;<wbr></wbr>
For use with <span class="nobreak"><span class="stt">--no-deps</span></span>; see <a href="#%28part._zo%29" data-pltdoc="x">Compiling to Raw Bytecode</a>.</p></li><li><p><span class="nobreak"><span class="stt">-no-prim</span></span> &#8212;<wbr></wbr> For use with <span class="nobreak"><span class="stt">--no-deps</span></span>; see
<a href="#%28part._zo%29" data-pltdoc="x">Compiling to Raw Bytecode</a>.</p></li><li><p><span class="nobreak"><span class="stt">-v</span></span> &#8212;<wbr></wbr> Verbose mode, which shows which files are
compiled.</p></li><li><p><span class="nobreak"><span class="stt">--vv</span></span> &#8212;<wbr></wbr> Very verbose mode, which implies <span class="nobreak"><span class="stt">-v</span></span> and
also shows every dependency that is checked.</p></li></ul><h4>1.1<tt>&nbsp;</tt><a name="(part._.Bytecode_.Files)"></a>Bytecode Files</h4><p>A file <span class="stt">"&#8249;<span style="font-style: italic">name</span>&#8250;.&#8249;<span style="font-style: italic">ext</span>&#8250;"</span> is compiled to bytecode
that is saved as <span class="stt">"compiled/&#8249;<span style="font-style: italic">name</span>&#8250;_&#8249;<span style="font-style: italic">ext</span>&#8250;.zo"</span>
relative to the file. As a result, the bytecode file is normally used
automatically when <span class="stt">"&#8249;<span style="font-style: italic">name</span>&#8250;.&#8249;<span style="font-style: italic">ext</span>&#8250;"</span> is required
as a module, since the underlying <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._load%2Fuse-compiled%29%29" class="RktValLink" data-pltdoc="x">load/use-compiled</a></span> operation
detects such a bytecode file.</p><p>For example, in a directory that contains the following files:</p><ul><li><p><span class="stt">"a.rkt"</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><a href="../guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"b.rkt"</span><span class="hspace">&nbsp;</span><span class="RktVal">"c.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr></table></blockquote></li><li><p><span class="stt">"b.rkt"</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><a href="../guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr></table></blockquote></li><li><p><span class="stt">"c.rkt"</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><a href="../guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="../reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr></table></blockquote></li></ul><p>then</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco make a.rkt</span></p><p>triggers the creation of <span class="stt">"compiled/a_rkt.zo"</span>,
<span class="stt">"compiled/b_rkt.zo"</span>, and <span class="stt">"compiled/c_rkt.zo"</span>.
A subsequent</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">racket a.rkt</span></p><p>loads bytecode from the generated <span class="stt">".zo"</span> files, paying
attention to the <span class="stt">".rkt"</span> sources only to confirm that each
<span class="stt">".zo"</span> file has a later timestamp.</p><p>In contrast,</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco make b.rkt c.rkt</span></p><p>would create only <span class="stt">"compiled/b_rkt.zo"</span> and
<span class="stt">"compiled/c_rkt.zo"</span>, since neither <span class="stt">"b.rkt"</span> nor
<span class="stt">"c.rkt"</span> imports <span class="stt">"a.rkt"</span>.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._.Dependency_.Files)"></a>Dependency Files</h4><p>In addition to a bytecode file, <span class="stt">raco make</span> creates a file
<span class="stt">"compiled/&#8249;<span style="font-style: italic">name</span>&#8250;_&#8249;<span style="font-style: italic">ext</span>&#8250;.dep"</span> that records
dependencies of the compiled module on other module files and the
source file&rsquo;s SHA-1 hash.  Using this dependency information, a
re-compilation request via <span class="stt">raco make</span> can consult both the
source file&rsquo;s timestamp/hash and the timestamps/hashes for the
bytecode of imported modules.  Furthermore, imported modules are
themselves compiled as necessary, including updating the bytecode and
dependency files for the imported modules, transitively.</p><p>Continuing the <span class="stt">raco make a.rkt</span> example from the previous
section, the <span class="stt">raco make</span> command creates
<span class="stt">"compiled/a_rkt.dep"</span>, <span class="stt">"compiled/b_rkt.dep"</span>, and
<span class="stt">"compiled/c_rkt.dep"</span> at the same time as the <span class="stt">".zo"</span>
files. The <span class="stt">"compiled/a_rkt.dep"</span> file records the dependency
of <span class="stt">"a.rkt"</span> on <span class="stt">"b.rkt"</span>, <span class="stt">"c.rkt"</span> and the
<a href="../reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a> library. If the <span class="stt">"b.rkt"</span> file is
modified (so that its timestamp and SHA-1 hash changes), then running</p><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco make a.rkt</span></p><p>again rebuilds <span class="stt">"compiled/a_rkt.zo"</span> and
<span class="stt">"compiled/b_rkt.zo"</span>.</p><p>For module files that are within library collections, <span class="stt">raco
setup</span> uses the same <span class="stt">".zo"</span> and <span class="stt">".dep"</span> conventions
and files as <span class="stt">raco make</span>, so the two tools can be used together.</p><h4>1.3<tt>&nbsp;</tt><a name="(part._.A.P.I_for_.Making_.Bytecode)"></a><a name="(mod-path._compiler/cm)"></a>API for Making Bytecode</h4><p><div class="SIntrapara"><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._compiler%2Fcm%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm</span></a><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">The <a href="#%28mod-path._compiler%2Fcm%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm</span></a> module
implements the compilation and dependency management used by
<span class="stt">raco make</span> and <span class="stt">raco setup</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td colspan="3"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._make-compilation-manager-load/use-compiled-handler))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span></span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">delete-zos-when-rkt-file-does-not-exist?</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:security-guard</span><span class="hspace">&nbsp;</span><span class="RktVar">security-guard</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._false%2Fc%29%29" class="RktValLink" data-pltdoc="x">false/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">delete-zos-when-rkt-file-does-not-exist?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">security-guard</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/securityguards.html#%28def._%28%28quote._~23~25kernel%29._security-guard~3f%29%29" class="RktValLink" data-pltdoc="x">security-guard?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a procedure suitable as a value for the
<span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._current-load%2Fuse-compiled%29%29" class="RktValLink" data-pltdoc="x">current-load/use-compiled</a></span> parameter. The returned procedure
passes it arguments on to the <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._current-load%2Fuse-compiled%29%29" class="RktValLink" data-pltdoc="x">current-load/use-compiled</a></span>
procedure that is installed when
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> is called,
but first it automatically compiles a source file to a <span class="stt">".zo"</span>
file if</div></p><ul><li><p>the file is expected to contain a module (i.e., the second
argument to the handler is a symbol);</p></li><li><p>the value of each of <span class="RktPn">(</span><span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._current-eval%29%29" class="RktValLink" data-pltdoc="x">current-eval</a></span><span class="RktPn">)</span>,
<span class="RktPn">(</span><span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._current-load%29%29" class="RktValLink" data-pltdoc="x">current-load</a></span><span class="RktPn">)</span>, and <span class="RktPn">(</span><span class="RktSym"><a href="../reference/Namespaces.html#%28def._%28%28quote._~23~25kernel%29._namespace-module-registry%29%29" class="RktValLink" data-pltdoc="x">namespace-module-registry</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Namespaces.html#%28def._%28%28quote._~23~25kernel%29._current-namespace%29%29" class="RktValLink" data-pltdoc="x">current-namespace</a></span><span class="RktPn">)</span><span class="RktPn">)</span> is the same as when
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> was
called;</p></li><li><p>the value of <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._use-compiled-file-paths%29%29" class="RktValLink" data-pltdoc="x">use-compiled-file-paths</a></span> contains the
first path that was present when
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> was
called;</p></li><li><p>the value of <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._current-load%2Fuse-compiled%29%29" class="RktValLink" data-pltdoc="x">current-load/use-compiled</a></span> is the result
of this procedure; and</p></li><li><p>one of the following holds:</p><ul><li><p>the source file is newer than the <span class="stt">".zo"</span> file in the
first sub-directory listed in <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._use-compiled-file-paths%29%29" class="RktValLink" data-pltdoc="x">use-compiled-file-paths</a></span>
(at the time that
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span>
was called), and either no <span class="stt">".dep"</span> file exists or it
records a source-file SHA-1 hash that differs from the current
version and source-file SHA-1 hash;</p></li><li><p>no <span class="stt">".dep"</span> file exists next to the <span class="stt">".zo"</span>
file;</p></li><li><p>the version recorded in the <span class="stt">".dep"</span> file does not
match the result of <span class="RktPn">(</span><span class="RktSym"><a href="../reference/runtime.html#%28def._%28%28quote._~23~25kernel%29._version%29%29" class="RktValLink" data-pltdoc="x">version</a></span><span class="RktPn">)</span>;</p></li><li><p>one of the files listed in the <span class="stt">".dep"</span> file has a
<span class="stt">".zo"</span> timestamp newer than the target <span class="stt">".zo"</span>,
and the combined hashes of the dependencies recorded in the
<span class="stt">".dep"</span> file does not match the combined hash recorded
in the <span class="stt">".dep"</span> file.</p></li></ul></li></ul><p>If SHA-1 hashes override a timestamp-based decision to recompile the
file, then the target <span class="stt">".zo"</span> file&rsquo;s timestamp is updated to
the current time.</p><p>After the handler procedure compiles a <span class="stt">".zo"</span> file, it creates
a corresponding <span class="stt">".dep"</span> file that lists the current version
and the identification of every file that is directly
<span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span>d by the module in the compiled file. Additional
dependencies can be installed during compilation via
<a href="#%28mod-path._compiler%2Fcm-accomplice%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm-accomplice</span></a>. The <span class="stt">".dep"</span> file also
records the SHA-1 hash of the module&rsquo;s source, and it records a
combined SHA-1 hash of all of the dependencies that includes their
recursive dependencies.</p><p>The handler caches timestamps when it checks <span class="stt">".dep"</span> files,
and the cache is maintained across calls to the same handler. The
cache is not consulted to compare the immediate source file to its
<span class="stt">".zo"</span> file, which means that the caching behavior is
consistent with the caching of the default module name resolver (see
<span class="RktSym"><a href="../reference/Module_Names_and_Loading.html#%28def._%28%28quote._~23~25kernel%29._current-module-name-resolver%29%29" class="RktValLink" data-pltdoc="x">current-module-name-resolver</a></span>).</p><p>If <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._use-compiled-file-paths%29%29" class="RktValLink" data-pltdoc="x">use-compiled-file-paths</a></span> contains an empty list when
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> is called,
then <span class="RktSym"><a href="../reference/exns.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._exn~3afail~3acontract%29%29" class="RktValLink" data-pltdoc="x">exn:fail:contract</a></span> exception is raised.</p><p>If the <span class="RktVar">delete-zos-when-rkt-file-does-not-exist?</span> argument is a true
value, then the returned handler will delete <span class="stt">".zo"</span> files
when there is no corresponding original source file.</p><p>If the <span class="RktVar">security-guard</span> argument is supplied, it is used when
creating <span class="stt">".zo"</span> files, <span class="stt">".dep"</span> files, and <span class="stt">"compiled/"</span>
directories, and when it adjusts the timestamps for existing files.
If it is <span class="RktVal">#f</span>, then
the security guard in the <span class="RktSym"><a href="../reference/securityguards.html#%28def._%28%28quote._~23~25kernel%29._current-security-guard%29%29" class="RktValLink" data-pltdoc="x">current-security-guard</a></span> when
the files are created is used (not the security guard at the point
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> is called).</p><p><span style="font-style: italic">Do not</span> install the result of
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> when the
current namespace contains already-loaded versions of modules that may
need to be recompiled&#8212;<wbr></wbr>unless the already-loaded modules are never
referenced by not-yet-loaded modules. References to already-loaded
modules may produce compiled files with inconsistent timestamps and/or
<span class="stt">".dep"</span> files with incorrect information.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._managed-compile-zo))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._managed-compile-zo%29%29" class="RktValLink" data-pltdoc="x">managed-compile-zo</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">file</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">read-src-syntax</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:security-guard</span><span class="hspace">&nbsp;</span><span class="RktVar">security-guard</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">file</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._path-string~3f%29%29" class="RktValLink" data-pltdoc="x">path-string?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">read-src-syntax</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#%28def._%28%28quote._~23~25kernel%29._input-port~3f%29%29" class="RktValLink" data-pltdoc="x">input-port?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax~3f%29%29" class="RktValLink" data-pltdoc="x">syntax?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read-syntax%29%29" class="RktValLink" data-pltdoc="x">read-syntax</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">security-guard</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/securityguards.html#%28def._%28%28quote._~23~25kernel%29._security-guard~3f%29%29" class="RktValLink" data-pltdoc="x">security-guard?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Compiles the given module source file to a <span class="stt">".zo"</span>, installing
a compilation-manager handler while the file is compiled (so that
required modules are also compiled), and creating a <span class="stt">".dep"</span> file
to record the timestamps of immediate files used to compile the source
(i.e., files <span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span>d in the source).</div></p><p>If <span class="RktVar">file</span> is compiled from source, then
<span class="RktVar">read-src-syntax</span> is used in the same way as
<span class="RktSym"><a href="../reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read-syntax%29%29" class="RktValLink" data-pltdoc="x">read-syntax</a></span> to read the source module. The normal
<span class="RktSym"><a href="../reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read-syntax%29%29" class="RktValLink" data-pltdoc="x">read-syntax</a></span> is used for any required files, however.</p><p>If <span class="RktVar">security-guard</span> is not <span class="RktVal">#f</span>, then the provided security
guard is used when creating the <span class="stt">"compiled/"</span> directories,
<span class="stt">".dep"</span> and <span class="stt">".zo"</span> files, and when it adjusts the timestamps
of existing files. If it is <span class="RktVal">#f</span>, then
the security guard in the <span class="RktSym"><a href="../reference/securityguards.html#%28def._%28%28quote._~23~25kernel%29._current-security-guard%29%29" class="RktValLink" data-pltdoc="x">current-security-guard</a></span> when
the files are created is used (not the security guard at the point
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._managed-compile-zo%29%29" class="RktValLink" data-pltdoc="x">managed-compile-zo</a></span> is called).</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._trust-existing-zos))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._trust-existing-zos%29%29" class="RktValLink" data-pltdoc="x">trust-existing-zos</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._trust-existing-zos%29%29" class="RktValLink" data-pltdoc="x">trust-existing-zos</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">trust?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">trust?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">A parameter that is intended for use by <span class="stt">setup-plt</span> when
installing with pre-built <span class="stt">".zo"</span> files. It causes a
compilation-manager <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._load%2Fuse-compiled%29%29" class="RktValLink" data-pltdoc="x">load/use-compiled</a></span> handler to &ldquo;touch&rdquo;
out-of-date <span class="stt">".zo"</span> files instead of re-compiling from source.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td colspan="3"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._make-caching-managed-compile-zo))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-caching-managed-compile-zo%29%29" class="RktValLink" data-pltdoc="x">make-caching-managed-compile-zo</a></span></span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">read-src-syntax</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:security-guard</span><span class="hspace">&nbsp;</span><span class="RktVar">security-guard</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._path-string~3f%29%29" class="RktValLink" data-pltdoc="x">path-string?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">read-src-syntax</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#%28def._%28%28quote._~23~25kernel%29._input-port~3f%29%29" class="RktValLink" data-pltdoc="x">input-port?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax~3f%29%29" class="RktValLink" data-pltdoc="x">syntax?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">security-guard</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/securityguards.html#%28def._%28%28quote._~23~25kernel%29._security-guard~3f%29%29" class="RktValLink" data-pltdoc="x">security-guard?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a procedure that behaves like <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._managed-compile-zo%29%29" class="RktValLink" data-pltdoc="x">managed-compile-zo</a></span>
(providing the same <span class="RktVar">read-src-syntax</span> each time), but a cache
of timestamp information is preserved across calls to the procedure.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._manager-compile-notify-handler))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-compile-notify-handler%29%29" class="RktValLink" data-pltdoc="x">manager-compile-notify-handler</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-compile-notify-handler%29%29" class="RktValLink" data-pltdoc="x">manager-compile-notify-handler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">notify</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">notify</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A parameter for a procedure of one argument that is called whenever a
compilation starts. The argument to the procedure is the file&rsquo;s path.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._manager-trace-handler))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-trace-handler%29%29" class="RktValLink" data-pltdoc="x">manager-trace-handler</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-trace-handler%29%29" class="RktValLink" data-pltdoc="x">manager-trace-handler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">notify</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">notify</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A parameter for a procedure of one argument that is called to report
 compilation-manager actions, such as checking a file. The argument to
 the procedure is a string.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._manager-skip-file-handler))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-skip-file-handler%29%29" class="RktValLink" data-pltdoc="x">manager-skip-file-handler</a></span></span><span class="RktPn"></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">promise?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-skip-file-handler%29%29" class="RktValLink" data-pltdoc="x">manager-skip-file-handler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">promise?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">A parameter whose value is called for each file that is loaded and
 needs recompilation. If the procedure returns a pair, then the file
 is skipped (i.e., not compiled); the number in the pair is used as
 the timestamp for the file&rsquo;s bytecode, and the promise may be
 <span class="RktSym">force</span>d to obtain a string that is used as hash of the
 compiled file plus its dependencies. If the procedure returns
 <span class="RktVal">#f</span>, then the file is compiled as usual. The default is
 <span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">#f</span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._file-stamp-in-collection))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._file-stamp-in-collection%29%29" class="RktValLink" data-pltdoc="x">file-stamp-in-collection</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">promise?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Calls <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._file-stamp-in-paths%29%29" class="RktValLink" data-pltdoc="x">file-stamp-in-paths</a></span> with <span class="RktVar">p</span> and
<span class="RktPn">(</span><span class="RktSym"><a href="../reference/collects.html#%28def._%28%28quote._~23~25kernel%29._current-library-collection-paths%29%29" class="RktValLink" data-pltdoc="x">current-library-collection-paths</a></span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._file-stamp-in-paths))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._file-stamp-in-paths%29%29" class="RktValLink" data-pltdoc="x">file-stamp-in-paths</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span><span class="RktVar">paths</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._cons%2Fc%29%29" class="RktValLink" data-pltdoc="x">cons/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">promise?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">paths</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns the file-modification date and <span class="RktSym">delay</span>ed hash of
 <span class="RktVar">p</span> or its bytecode form (i.e., <span class="stt">".zo"</span> file), whichever
 exists and is newer, if <span class="RktVar">p</span> is an extension of any path in
 <span class="RktVar">paths</span> (i.e., exists in the directory, a subdirectory,
 etc.). Otherwise, the result is <span class="RktVal">#f</span>.</div></p><p>This function is intended for use with <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._manager-skip-file-handler%29%29" class="RktValLink" data-pltdoc="x">manager-skip-file-handler</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._get-file-sha1))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._get-file-sha1%29%29" class="RktValLink" data-pltdoc="x">get-file-sha1</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Computes a SHA-1 hash for the file <span class="RktVar">p</span>; the result is
<span class="RktVal">#f</span> if <span class="RktVar">p</span> cannot be opened.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._get-compiled-file-sha1))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._get-compiled-file-sha1%29%29" class="RktValLink" data-pltdoc="x">get-compiled-file-sha1</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Computes a SHA-1 hash for the bytecode file <span class="RktVar">p</span>, appending any
dependency-describing hash available from a <span class="stt">".dep"</span> file when
available (i.e., the suffix on <span class="RktVar">p</span> is replaced by
<span class="stt">".dep"</span> to locate dependency information). The result is
<span class="RktVal">#f</span> if <span class="RktVar">p</span> cannot be opened.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._with-compile-output))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._with-compile-output%29%29" class="RktValLink" data-pltdoc="x">with-compile-output</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">p</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._path-string~3f%29%29" class="RktValLink" data-pltdoc="x">path-string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">port</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/port-ops.html#%28def._%28%28quote._~23~25kernel%29._input-port~3f%29%29" class="RktValLink" data-pltdoc="x">input-port?</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">tmp-path</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Opens a temporary path for writing and calls <span class="RktVar">proc</span> passing the
resulting <span class="RktSym">port</span> and <span class="RktSym">tmp-path</span>.  Once <span class="RktVar">proc</span>
returns, <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._with-compile-output%29%29" class="RktValLink" data-pltdoc="x">with-compile-output</a></span> renames <span class="RktSym">tmp-path</span> to
<span class="RktVar">p</span> and arranges to delete <span class="RktSym">temp-path</span> if there&rsquo;s an
exception.  Breaks are managed so that the <span class="RktSym">port</span> is reliably
closed and the <span class="RktSym">tmp-path</span> file is reliably deleted if there&rsquo;s a
break. The result of <span class="RktVar">proc</span> is the result of the
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._with-compile-output%29%29" class="RktValLink" data-pltdoc="x">with-compile-output</a></span> call.</div></p><p>Windows prevents programs from overwriting files that are open. As a result,
<span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._with-compile-output%29%29" class="RktValLink" data-pltdoc="x">with-compile-output</a></span> calls to <span class="RktSym"><a href="../reference/Filesystem.html#%28def._%28%28quote._~23~25kernel%29._rename-file-or-directory%29%29" class="RktValLink" data-pltdoc="x">rename-file-or-directory</a></span> will
fail if the destination file argument is an open file. Windows, however, does
allow you to rename an open file. To avoid overwriting open files
windows, <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._with-compile-output%29%29" class="RktValLink" data-pltdoc="x">with-compile-output</a></span> creates a second temporary file
<span class="RktSym">tmp-path2</span>, renames <span class="RktVar">p</span> to <span class="RktSym">tmp-path2</span>, renames
<span class="RktSym">tmp-path</span> to <span class="RktVar">p</span>, and finally deletes <span class="RktSym">tmp-path2</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._parallel-lock-client))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._parallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">parallel-lock-client</a></span></span><span class="RktPn"></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3ei%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>i</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">command</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">unlock</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._file%29%29" class="RktStxLink" data-pltdoc="x">file</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">command</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">command</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._parallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">parallel-lock-client</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">proc</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3ei%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>i</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">command</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">unlock</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._file%29%29" class="RktStxLink" data-pltdoc="x">file</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">command</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">command</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Holds the parallel compilation lock client, which
is used by the result of <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> to
prevent compilation races between parallel builders.</div></p><p>When <span class="RktVar">proc</span> is <span class="RktVal">#f</span> (the default), no checking for parallel
compilation is done (and thus multiple threads or places running compilations
via <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span> will potentially
corrupt each other&rsquo;s <span class="stt">".zo"</span> files).</p><p>When <span class="RktVar">proc</span> is a function, its first argument is a command, indicating
if it wants to lock or unlock the path specified in the second argument.</p><p>When the <span class="RktVar">proc</span> <span class="RktVal">'</span><span class="RktVal">lock</span> command returns <span class="RktVal">#t</span>, the current
builder has obtained the lock for <span class="RktSym">zo-path</span>.
Once compilation of <span class="RktSym">zo-path</span> is complete, the builder process must
release the lock by calling <span class="RktVar">proc</span> <span class="RktVal">'</span><span class="RktVal">unlock</span> with the exact same
<span class="RktSym">zo-path</span>.</p><p>When the <span class="RktVar">proc</span> <span class="RktVal">'</span><span class="RktVal">lock</span> command returns <span class="RktVal">#f</span>, another
parallel builder obtained the lock first and has already compiled the zo.  The
parallel builder should continue without compiling <span class="RktSym">zo-path</span>.
(In this case, <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compilation-manager-load%2Fuse-compiled-handler%29%29" class="RktValLink" data-pltdoc="x">make-compilation-manager-load/use-compiled-handler</a></span>&rsquo;s
result will not call <span class="RktVar">proc</span> with <span class="RktVal">'</span><span class="RktVal">unlock</span>.)</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" class="RktStxLink" data-pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">lc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._parallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">parallel-lock-client</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">zo-name</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#"collects/racket/compiled/draw_rkt.zo"</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">locked?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="hspace">&nbsp;</span><span class="RktSym">zo-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">ok-to-compile?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">lc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">locked?</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/cont.html#%28def._%28%28quote._~23~25kernel%29._dynamic-wind%29%29" class="RktValLink" data-pltdoc="x">dynamic-wind</a></span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ok-to-compile?</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Do compile here ...\n"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktSym">locked?</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">unlock</span><span class="hspace">&nbsp;</span><span class="RktSym">zo-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktOut">Do compile here ...</span></p></td></tr><tr><td><table cellspacing="0"><tr><td></td></tr></table></td></tr></table></blockquote></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._compile-lock-~3eparallel-lock-client))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._compile-lock-~3eparallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">compile-lock-&gt;parallel-lock-client</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">pc</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktVar">cust</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">lock</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">unlock</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">place-channel?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">cust</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/custodians.html#%28def._%28%28quote._~23~25kernel%29._custodian~3f%29%29" class="RktValLink" data-pltdoc="x">custodian?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a function that follows the <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._parallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">parallel-lock-client</a></span>
by communicating over <span class="RktVar">pc</span>. The argument must have
be the result of <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compile-lock%29%29" class="RktValLink" data-pltdoc="x">make-compile-lock</a></span>.</div></p><p>This communication protocol implementation is not kill safe. To make it kill safe,
it needs a sufficiently powerful custodian, i.e., one that is not subject to
termination (unless all of the participants in the compilation are also terminated).
It uses this custodian to create a thread that monitors the threads that are
doing the compilation. If one of them is terminated, the presence of the
custodian lets another one continue. (The custodian is also used to create
a thread that manages a thread safe table.)</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm..rkt)._make-compile-lock))"></a><span title="Provided from: compiler/cm"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._make-compile-lock%29%29" class="RktValLink" data-pltdoc="x">make-compile-lock</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">place-channel?</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Creates a <span class="RktSym">place-channel?</span> that can be used with
          <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm..rkt%29._compile-lock-~3eparallel-lock-client%29%29" class="RktValLink" data-pltdoc="x">compile-lock-&gt;parallel-lock-client</a></span> to avoid concurrent
          compilations of the same racket source files in multiple places.</div></p><h4>1.4<tt>&nbsp;</tt><a name="(part._api~3aparallel-build)"></a><a name="(mod-path._setup/parallel-build)"></a>API for Parallel Builds</h4><p><div class="SIntrapara"><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._setup%2Fparallel-build%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">setup/parallel-build</span></a><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">The <a href="#%28mod-path._setup%2Fparallel-build%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">setup/parallel-build</span></a> library provides the parallel-compilation
functionality of <span class="stt">raco setup</span> and <span class="stt">raco make</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._setup/parallel-build..rkt)._parallel-compile-files))"></a><span title="Provided from: setup/parallel-build"><span class="RktSym"><a href="#%28def._%28%28lib._setup%2Fparallel-build..rkt%29._parallel-compile-files%29%29" class="RktValLink" data-pltdoc="x">parallel-compile-files</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">list-of-files</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:worker-count</span><span class="hspace">&nbsp;</span><span class="RktVar">worker-count</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:handler</span><span class="hspace">&nbsp;</span><span class="RktVar">handler</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">list-of-files</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">worker-count</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">non-negative-integer?</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/futures.html#%28def._%28%28lib._racket%2Ffuture..rkt%29._processor-count%29%29" class="RktValLink" data-pltdoc="x">processor-count</a></span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">handler</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3ei%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>i</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">handler-type</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">path</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._path-string~3f%29%29" class="RktValLink" data-pltdoc="x">path-string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">msg</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">out</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">err</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span><span class="RktPn">)</span></td></tr></table></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="#%28def._%28%28lib._setup%2Fparallel-build..rkt%29._parallel-compile%29%29" class="RktValLink" data-pltdoc="x">parallel-compile</a></span> utility function is used by <span class="stt">raco make</span> to
compile a list of paths in parallel.  The optional
<span class="RktPn">#:worker-count</span> argument specifies the number of compile workers to spawn during
parallel compilation.  The callback, <span class="RktVar">handler</span>, is called with the symbol
<span class="RktVal">'</span><span class="RktVal">done</span> as the <span class="RktVar">handler-type</span> argument for each successfully compiled file,
<span class="RktVal">'</span><span class="RktVal">output</span> when a
successful compilation produces stdout/stderr output, <span class="RktVal">'</span><span class="RktVal">error</span> when a
compilation error has occured, or <span class="RktVal">'</span><span class="RktVal">fatal-error</span> when a unrecoverable
error occurs. The other arguments give more information for each status update.</div></p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._setup%2Fparallel-build..rkt%29._parallel-compile-files%29%29" class="RktValLink" data-pltdoc="x">parallel-compile-files</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">source-files</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:worker-count</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:handler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span><span class="RktSym">work</span><span class="hspace">&nbsp;</span><span class="RktSym">msg</span><span class="hspace">&nbsp;</span><span class="RktSym">out</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">done</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">verbose</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" Made ~a\n"</span><span class="hspace">&nbsp;</span><span class="RktSym">work</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">output</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" Output from: ~a\n~a~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">work</span><span class="hspace">&nbsp;</span><span class="RktSym">out</span><span class="hspace">&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" class="RktValLink" data-pltdoc="x">printf</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" Error compiling ~a\n~a\n~a~a"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">work</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">msg</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">out</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">err</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" class="prototype RForeground"><tr><td><span class="RktPn">(</span><a name="(def._((lib._setup/parallel-build..rkt)._parallel-compile))"></a><span title="Provided from: setup/parallel-build"><span class="RktSym"><a href="#%28def._%28%28lib._setup%2Fparallel-build..rkt%29._parallel-compile%29%29" class="RktValLink" data-pltdoc="x">parallel-compile</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">worker-count</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">setup-fprintf</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">append-error</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">collects-tree</span><span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">worker-count</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">non-negative-integer?</span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">setup-fprintf</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%2A%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">stage</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:rest</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">append-error</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">cc?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">prefix</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="../reference/exns.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._exn%29%29" class="RktValLink" data-pltdoc="x">exn</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._or%2Fc%29%29" class="RktValLink" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/exns.html#%28def._%28%28quote._~23~25kernel%29._exn~3f%29%29" class="RktValLink" data-pltdoc="x">exn?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null~3f%29%29" class="RktValLink" data-pltdoc="x">null?</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">out</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">err</span><span class="hspace">&nbsp;</span><span class="RktSym">srtring?</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">message</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">collects-tree</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The <span class="RktSym"><a href="#%28def._%28%28lib._setup%2Fparallel-build..rkt%29._parallel-compile%29%29" class="RktValLink" data-pltdoc="x">parallel-compile</a></span> internal utility function is used by <span class="stt">rack
setup</span> to compile collects in parallel.  The <span class="RktVar">worker-count</span> argument
specifies the number of compile workers to spawn during parallel compilation.
The <span class="RktVar">setup-fprintf</span> and <span class="RktVar">append-error</span> functions are internal
callback mechanisms that <span class="stt">raco setup</span> uses to communicate intermediate
compilation results.  The <span class="RktVar">collects-tree</span> argument is a compound
datastructure containing an in-memory tree representation of the collects
directory.</div></p><h4>1.5<tt>&nbsp;</tt><a name="(part._.Compilation_.Manager_.Hook_for_.Syntax_.Transformers)"></a><a name="(mod-path._compiler/cm-accomplice)"></a>Compilation Manager Hook for Syntax Transformers</h4><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._compiler%2Fcm-accomplice%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm-accomplice</span></a><span class="RktPn">)</span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm-accomplice..rkt)._register-external-file))"></a><span title="Provided from: compiler/cm-accomplice"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm-accomplice..rkt%29._register-external-file%29%29" class="RktValLink" data-pltdoc="x">register-external-file</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">file</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">file</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._complete-path~3f%29%29" class="RktValLink" data-pltdoc="x">complete-path?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Logs a message (see <span class="RktSym"><a href="../reference/logging.html#%28def._%28%28quote._~23~25kernel%29._log-message%29%29" class="RktValLink" data-pltdoc="x">log-message</a></span>) at level <span class="RktVal">'</span><span class="RktVal">info</span>. The
message data is a <span class="RktSym">file-dependency</span> prefab structure type
with two fields; the first field&rsquo;s value is <span class="RktVar">file</span> and the second
field&rsquo;s value is <span class="RktVal">#f</span> (to indicate a non-module dependency).</div></p><p>A compilation manager implemented by <a href="#%28mod-path._compiler%2Fcm%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm</span></a> looks
for such messages to register an external dependency. The compilation
manager records (in a <span class="stt">".dep"</span> file) the path as contributing
to the implementation of the module currently being
compiled. Afterward, if the registered file is modified, the
compilation manager will know to recompile the module.</p><p>The <span class="RktSym"><a href="../reference/include.html#%28form._%28%28lib._racket%2Finclude..rkt%29._include%29%29" class="RktStxLink" data-pltdoc="x">include</a></span> macro, for example, calls this procedure with the
path of an included file as it expands an <span class="RktSym"><a href="../reference/include.html#%28form._%28%28lib._racket%2Finclude..rkt%29._include%29%29" class="RktStxLink" data-pltdoc="x">include</a></span> form.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._compiler/cm-accomplice..rkt)._register-external-module))"></a><span title="Provided from: compiler/cm-accomplice"><span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm-accomplice..rkt%29._register-external-module%29%29" class="RktValLink" data-pltdoc="x">register-external-module</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">file</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">file</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._path~3f%29%29" class="RktValLink" data-pltdoc="x">path?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Manipulating_Paths.html#%28def._%28%28quote._~23~25kernel%29._complete-path~3f%29%29" class="RktValLink" data-pltdoc="x">complete-path?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28def._%28%28lib._compiler%2Fcm-accomplice..rkt%29._register-external-file%29%29" class="RktValLink" data-pltdoc="x">register-external-file</a></span>, but logs a message with a
<span class="RktSym">file-dependency</span> prefab structure type whose second
field is <span class="RktVal">#t</span>.</div></p><p>A compilation manager implemented by <a href="#%28mod-path._compiler%2Fcm%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">compiler/cm</span></a>
recognizes the message to register a dependency on a
module (which implies a dependency on all of that module&rsquo;s
dependencies, etc.).</p><h4>1.6<tt>&nbsp;</tt><a name="(part._zo)"></a>Compiling to Raw Bytecode</h4><p>The <span class="nobreak"><span class="stt">--no-deps</span></span> mode for <span class="stt">raco make</span> is an improverished
form of the compilation, because it does not track import
dependencies. It does, however, support compilation of non-module
source in an namespace that initially imports <a href="../scheme/scheme.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">scheme</span></a>.</p><p>Outside of a module, top-level <span class="RktSym"><a href="../reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-syntaxes</a></span>,
<span class="RktSym"><a href="../reference/module.html#%28form._%28%28quote._~23~25kernel%29._module%29%29" class="RktStxLink" data-pltdoc="x">module</a></span>, <span class="RktSym"><a href="../reference/require.html#%28form._%28%28quote._~23~25kernel%29._~23~25require%29%29" class="RktStxLink" data-pltdoc="x">#%require</a></span>,
<span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fdefine..rkt%29._define-values-for-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-values-for-syntax</a></span>, and <span class="RktSym"><a href="../reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin%29%29" class="RktStxLink" data-pltdoc="x">begin</a></span> expressions
are handled specially by <span class="stt">raco make --no-deps</span>: the compile-time
portion of the expression is evaluated, because it might affect later
expressions.</p><p>For example, when compiling the file containing</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/class</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">class</span><span class="hspace">&nbsp;</span><span class="RktSym">object%</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">super-new</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>the <span class="RktSym">class</span> form from the <a href="../reference/mzlib_class.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket/class</span></a> library
must be bound in the compilation namespace at compile time. Thus, the
<span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span> expression is both compiled (to appear in the output
code) and evaluated (for further computation).</p><p>Many definition forms expand to <span class="RktSym"><a href="../reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-syntaxes</a></span>. For example,
<span class="RktSym">define-signature</span> expands to <span class="RktSym"><a href="../reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-syntaxes</a></span>. In
<span class="nobreak"><span class="stt">--no-deps</span></span> mode, <span class="stt">raco make --no-deps</span> detects
<span class="RktSym"><a href="../reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-syntaxes</a></span> and other expressions after expansion, so
top-level <span class="RktSym">define-signature</span> expressions affect the compilation
of later expressions, as a programmer would expect.</p><p>In contrast, a <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._load%29%29" class="RktValLink" data-pltdoc="x">load</a></span> or <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._eval%29%29" class="RktValLink" data-pltdoc="x">eval</a></span> expression in a source
file is compiled&#8212;<wbr></wbr>but <span style="font-style: italic">not evaluated!</span>&#8212;<wbr></wbr>as the source file is
compiled.  Even if the <span class="RktSym"><a href="../reference/eval.html#%28def._%28%28quote._~23~25kernel%29._load%29%29" class="RktValLink" data-pltdoc="x">load</a></span> expression loads syntax or
signature definitions, these will not be loaded as the file is
compiled. The same is true of application expressions that affect the
reader, such as <span class="RktPn">(</span><span class="RktSym"><a href="../reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read-case-sensitive%29%29" class="RktValLink" data-pltdoc="x">read-case-sensitive</a></span><span class="stt"> </span><span class="RktVal">#t</span><span class="RktPn">)</span>. The <span class="nobreak"><span class="stt">-p</span></span> or
<span class="nobreak"><span class="stt">--prefix</span></span> flag for <span class="stt">raco make</span> takes a file and loads it before
compiling the source files specified on the command line.</p><p>By default, the namespace for compilation is initialized by a
<span class="RktSym"><a href="../reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span> of <a href="../scheme/scheme.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">scheme</span></a>. If the <span class="nobreak"><span class="stt">--no-prim</span></span>
flag is specified, the namespace is instead initialized with
<span class="RktSym"><a href="../reference/Namespaces.html#%28def._%28%28quote._~23~25kernel%29._namespace-require%2Fcopy%29%29" class="RktValLink" data-pltdoc="x">namespace-require/copy</a></span>, which allows mutation and
redefinition of all initial bindings (other than syntactic forms, in
the case of mutation).</p><p>In general, a better solution is to put all code to compile into a
module and use <span class="stt">raco make</span> in its default mode.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3.2&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="index.html" title="backward to &quot;raco: Racket Command-Line Tools&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;raco: Racket Command-Line Tools&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="link.html" title="forward to &quot;2 raco link: Library Collection Links&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>